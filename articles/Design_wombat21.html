<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Advanced Features and Design of wombat21 ‚Ä¢ wombat21</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Features and Design of wombat21">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">wombat21</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/wombat21.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/Design_wombat21.html">Design and Usage</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/MonashARP/game-package-wombats" aria-label="GitHub project repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Advanced Features and Design of wombat21</h1>
                        <h4 data-toc-skip class="author">Sun Yan Joanna
Ma, Wei Zhu Chen, Aneesh Agarwal</h4>
            
      

      <div class="d-none name"><code>Design_wombat21.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="design-philosophy">üéØ Design Philosophy<a class="anchor" aria-label="anchor" href="#design-philosophy"></a>
</h2>
<p><strong>wombat21</strong> is built for three main usage
modes‚Äî<strong>interactive gameplay</strong>, <strong>batch
simulation</strong>, and <strong>advanced visualization</strong>‚Äîall
with a modular, extensible, and high-performance architecture.</p>
<ul>
<li><p><strong>Interactive Play:</strong><br>
All user-facing gameplay logic is modular and transparent.<br>
Players can interact with human or AI opponents, with clear APIs for
betting, splitting, insurance, and persistent progress
tracking.</p></li>
<li><p><strong>Flexible Simulation:</strong><br>
The simulation engine is fully programmable:<br>
Users can run thousands of games automatically, passing custom strategy
functions (for splitting, insurance, etc.) and exploring the effects of
advanced rule variations or AI behavior.</p></li>
<li><p><strong>Rich Visualization:</strong><br>
Game results, player history, and simulation outcomes can be visualized
interactively‚Äîmaking it easy to analyze trends, compare strategies, and
communicate findings.</p></li>
</ul>
<p><strong>Modularity, extensibility, and performance</strong> are at
the core of wombat21‚Äôs design.<br>
All core components (cards, hands, strategies, players) are built using
robust object systems (vctrs, S3), and the scoring logic is accelerated
with C++ for fast, large-scale analysis.</p>
<p>This design philosophy ensures wombat21 is not just a game, but a
flexible engine for research, teaching, and advanced experimentation in
R.</p>
</div>
<div class="section level2">
<h2 id="function-names-and-arguments">üè∑Ô∏è Function Names and Arguments<a class="anchor" aria-label="anchor" href="#function-names-and-arguments"></a>
</h2>
<p>All user-facing functions in <code>wombat21</code> are named to be
clear, concise, and consistent, following common R conventions:</p>
<ul>
<li><p><strong>Verb-based names:</strong><br>
Functions perform an action and are named accordingly (e.g.,
<code><a href="../reference/play.html">play()</a></code>, <code><a href="../reference/simulate_blackjack.html">simulate_blackjack()</a></code>,
<code><a href="../reference/calculate_score.html">calculate_score()</a></code>).</p></li>
<li><p><strong>Explicit parameter names:</strong><br>
Arguments are descriptive, self-explanatory, and use snake_case (e.g.,
<code>num_rounds</code>, <code>bet_amount</code>,
<code>buy_insurance</code>, <code>split</code>).</p></li>
<li><p><strong>Strategy customization:</strong><br>
Where applicable, functions accept logical values or user-defined
functions as parameters (<code>split</code>,
<code>buy_insurance</code>), supporting flexible and advanced
gameplay.</p></li>
<li><p><strong>Consistent interface:</strong><br>
The same function can be used interactively (<code><a href="../reference/play.html">play()</a></code>), for
simulation (<code><a href="../reference/simulate_blackjack.html">simulate_blackjack()</a></code>), or for visualization
(<code><a href="../reference/plot_bankroll_history.html">plot_bankroll_history()</a></code>), all using familiar argument
conventions.</p></li>
<li><p><strong>Object arguments:</strong><br>
Game logic functions expect well-defined objects (e.g.,
<code>blackjack_hand</code>, <code>card</code>), ensuring type safety
and clear data flow.</p></li>
</ul>
<p><strong>Internal functions</strong> (not exported) are named with
clear, specific purposes, and marked with <code>@noRd</code> and
<code>@keywords internal</code> (e.g.,
<code>generate_blackjack_hands()</code>,
<code>calculate_score_r()</code>). These utilities support testing,
benchmarking, or code reuse, but are not part of the main user API.</p>
<p>This consistent naming and argument style makes the package intuitive
to use and easy to extend for both new and advanced users.</p>
</div>
<div class="section level2">
<h2 id="functions-specification">üóÇÔ∏è Functions Specification<a class="anchor" aria-label="anchor" href="#functions-specification"></a>
</h2>
<ol style="list-style-type: decimal">
<li>
<p><strong>Card Objects:</strong> Card validation and attribute
extraction [<em>Main Arguments</em>: <code>card</code> ]</p>
<ul>
<li><p><span style="color:gray"><em>card_utils.R</em></span>
Ôºö<code><a href="../reference/card_is_face.html">card_is_face()</a></code>, <code><a href="../reference/card_is_ace.html">card_is_ace()</a></code>,
<code><a href="../reference/card_value.html">card_value()</a></code>, <code><a href="../reference/card_suit.html">card_suit()</a></code>,
<code><a href="../reference/card_rank.html">card_rank()</a></code></p></li>
<li><p><span style="color:gray"><em>card-class.R</em></span>
Ôºö<code><a href="../reference/card.html">card()</a></code>, <code><a href="../reference/format.card.html">format.card()</a></code>,
<code><a href="../reference/print.card.html">print.card()</a></code>, <code><a href="../reference/vec_cast.card.html">vec_cast.card()</a></code>,
<code><a href="../reference/as.character.card.html">as.character.card()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Hand Objects:</strong> Hand creation and validation
[<em>Main Arguments</em>: <code>cards</code>, <code>hand</code>]</p>
<ul>
<li><p><span style="color:gray"><em>hand_utils.R</em></span>
Ôºö<code><a href="../reference/new_blackjack_hand.html">new_blackjack_hand()</a></code></p></li>
<li><p><span style="color:gray"><em>hand_type.R</em></span>
Ôºö<code><a href="../reference/is_five_card_charlie.html">is_five_card_charlie()</a></code>,
<code><a href="../reference/is_blackjack.html">is_blackjack()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Scoring Logic:</strong> Hand scoring and rules [<em>Main
Arguments</em>: <code>hand</code>, <code>card</code>]</p>
<ul>
<li><p><span style="color:gray"><em>score_cal.R</em></span>
Ôºö<code><a href="../reference/calculate_score.html">calculate_score()</a></code></p></li>
<li><p><span style="color:gray"><em>RcppExports.R</em></span>
Ôºö<code><a href="../reference/calculate_score_cpp.html">calculate_score_cpp()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Dealing &amp; Setup:</strong> Initial hands and deck
operations [<em>Main Arguments</em>: <code>players</code>,
<code>deck</code>]</p>
<ul>
<li><p><span style="color:gray"><em>deal_card.R</em></span>
Ôºö<code><a href="../reference/deal_cards.html">deal_cards()</a></code></p></li>
<li><p><span style="color:gray"><em>setup.R</em></span>
Ôºö<code><a href="../reference/setup_and_display_initial.html">setup_and_display_initial()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Gameplay:</strong> Main loop and player actions [<em>Main
Arguments</em>: none]</p>
<ul>
<li><p><span style="color:gray"><em>game_loop.R</em></span>
Ôºö<code><a href="../reference/play.html">play()</a></code>, <code><a href="../reference/ask_play_again.html">ask_play_again()</a></code>,
<code><a href="../reference/exit.html">exit()</a></code></p></li>
<li><p><span style="color:gray"><em>player_logic.R</em></span>
Ôºö<code><a href="../reference/player_action.html">player_action()</a></code>,
<code><a href="../reference/play_player_turns.html">play_player_turns()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Betting and Insurance</strong> [<em>Main Arguments</em>:
<code>players</code>, <code>hand</code>]</p>
<ul>
<li><p><span style="color:gray"><em>bets.R</em></span>
Ôºö<code><a href="../reference/get_bets.html">get_bets()</a></code></p></li>
<li><p><span style="color:gray"><em>Insurance.R</em></span>
Ôºö<code><a href="../reference/handle_insurance.html">handle_insurance()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Splitting</strong> [<em>Main Arguments</em>:
<code>hand</code>, <code>players</code>]</p>
<ul>
<li>
<span style="color:gray"><em>split.R</em></span>
Ôºö<code><a href="../reference/handle_splitting.html">handle_splitting()</a></code>
</li>
</ul>
</li>
<li>
<p><strong>Simulation</strong> [<em>Main Arguments</em>:
<code>num_rounds</code>, <code>split</code>,
<code>buy_insurance</code>]</p>
<ul>
<li>
<span style="color:gray"><em>simulation.R</em></span>
Ôºö<code><a href="../reference/simulate_blackjack.html">simulate_blackjack()</a></code>
</li>
</ul>
</li>
<li>
<p><strong>Result Judgement &amp; Summary</strong> [<em>Main
Arguments</em>: <code>scores</code>, <code>players</code>,
<code>hands</code>]</p>
<ul>
<li>
<span style="color:gray"><em>results.R</em></span>
Ôºö<code><a href="../reference/end_round.html">end_round()</a></code>, <code><a href="../reference/display_final_results.html">display_final_results()</a></code>,
<code><a href="../reference/determine_winner.html">determine_winner()</a></code>
</li>
</ul>
</li>
<li>
<p><strong>Player I/O &amp; Persistences</strong> [<em>Main
Arguments</em>: <code>players</code>, <code>bankroll</code>,
<code>id_map</code>]</p>
<ul>
<li><p><span style="color:gray"><em>input_player.R</em></span>
Ôºö<code><a href="../reference/input_players.html">input_players()</a></code></p></li>
<li><p><span style="color:gray"><em>io.R</em></span>
Ôºö<code><a href="../reference/save_players.html">save_players()</a></code>, <code><a href="../reference/load_players.html">load_players()</a></code>,
<code><a href="../reference/reset_game_data.html">reset_game_data()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Visualization</strong> [<em>Main Arguments</em>:
<code>bankroll_history</code>]</p>
<ul>
<li><p><span style="color:gray"><em>bankroll_graph.R</em></span>
Ôºö<code><a href="../reference/plot_bankroll_history.html">plot_bankroll_history()</a></code></p></li>
<li><p><span style="color:gray"><em>results.R</em></span>
Ôºö<code><a href="../reference/plot_player_ranking.html">plot_player_ranking()</a></code></p></li>
</ul>
</li>
<li>
<p><strong>Utilities</strong> [<em>Main Arguments</em>: none]</p>
<ul>
<li>
<span style="color:gray"><em>data_directory.R</em></span>
Ôºö`get_home_dir()</li>
</ul>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="core-data-structures">üóÉÔ∏è Core Data Structures<a class="anchor" aria-label="anchor" href="#core-data-structures"></a>
</h2>
<ul>
<li>
<strong>card</strong>: Represents a single playing card (fields:
<code>rank</code>, <code>suit</code>)</li>
<li>
<strong>blackjack_hand</strong>: Represents a player‚Äôs hand (field:
<code>cards</code>, a vector of card objects)</li>
<li>
<strong>players</strong>: List of player objects (fields:
<code>name</code>, <code>coins</code>, <code>is_computer</code>, ‚Ä¶)</li>
</ul>
<p>This structure supports flexible extension, validation, and efficient
manipulation via vctrs and S3.</p>
</div>
<div class="section level2">
<h2 id="object-system-with-vctrs">üß© Object System with vctrs<a class="anchor" aria-label="anchor" href="#object-system-with-vctrs"></a>
</h2>
<div class="section level3">
<h3 id="why-use-vctrs">
<strong>Why Use vctrs?</strong><a class="anchor" aria-label="anchor" href="#why-use-vctrs"></a>
</h3>
<p>The <code>vctrs</code> package provides a robust foundation for
type-safe, extensible object-oriented programming in R. In
<strong><code>wombat21</code></strong>, it powers the entire game logic
for cards and hands.</p>
<p><strong>1. Custom Card and Hand Classes</strong></p>
<p><code>wombat21</code> defines:</p>
<ul>
<li><p><strong><code>card</code></strong>: an object with
<code>rank</code> and <code>suit</code>, e.g., <code>"A‚ô†"</code>,
<code>"10‚ô¶"</code></p></li>
<li><p><strong><code>blackjack_hand</code></strong>: a player hand
consisting of <code>card</code> objects</p></li>
</ul>
<p>Both are built with <code><a href="https://vctrs.r-lib.org/reference/new_rcrd.html" class="external-link">vctrs::new_rcrd()</a></code>, enabling compact
storage and automatic validation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">card</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rank</span>, <span class="va">suit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/new_rcrd.html" class="external-link">new_rcrd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="va">rank</span>, suit <span class="op">=</span> <span class="va">suit</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"card"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">new_blackjack_hand</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cards</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/new_rcrd.html" class="external-link">new_rcrd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cards <span class="op">=</span> <span class="va">cards</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"blackjack_hand"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>2. Helper Functions and Safe Manipulation</strong></p>
<p>Custom card and hand objects can be safely manipulated using helper
functions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create cards and a hand</span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"‚ô†"</span><span class="op">)</span></span>
<span><span class="va">c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="st">"10"</span>, <span class="st">"‚ô¶"</span><span class="op">)</span></span>
<span><span class="va">hand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_blackjack_hand.html">new_blackjack_hand</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">c1</span>, <span class="va">c2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/card_rank.html">card_rank</a></span><span class="op">(</span><span class="va">hand</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span>    <span class="co"># Returns c("A", "10")</span></span>
<span><span class="fu"><a href="../reference/card_value.html">card_value</a></span><span class="op">(</span><span class="va">hand</span><span class="op">$</span><span class="va">cards</span><span class="op">)</span>   <span class="co"># Returns c(11, 10)</span></span></code></pre></div>
<p><em>These functions ensure your game logic is <strong>clean</strong>,
<strong>type-safe</strong>, and <strong>readable</strong>.</em></p>
<p><strong>3. Extending with S3 + vctrs</strong></p>
<p>All relevant behaviors‚Äîprinting, type coercion, equality‚Äîare
registered explicitly via <code><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">vctrs::s3_register()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Custom print method for card objects</span></span>
<span><span class="va">print.card</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"&lt;card: %s of %s&gt;\n"</span>, <span class="fu"><a href="../reference/card_rank.html">card_rank</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="../reference/card_suit.html">card_suit</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Register vctrs casting and type methods for cards</span></span>
<span><span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"vctrs::vec_cast"</span>, <span class="st">"card.character"</span><span class="op">)</span></span>
<span><span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"vctrs::vec_cast"</span>, <span class="st">"character.card"</span><span class="op">)</span></span>
<span><span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"vctrs::vec_ptype2"</span>, <span class="st">"card.character"</span><span class="op">)</span></span>
<span><span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"vctrs::vec_ptype2"</span>, <span class="st">"character.card"</span><span class="op">)</span></span>
<span><span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/s3_register.html" class="external-link">s3_register</a></span><span class="op">(</span><span class="st">"vctrs::vec_ptype2"</span>, <span class="st">"card.card"</span><span class="op">)</span></span></code></pre></div>
<p><em>This design ensures smooth interoperation with base R vectors and
custom behaviors.</em></p>
</div>
<div class="section level3">
<h3 id="benefits-for-advanced-users-developers">Benefits for Advanced Users &amp; Developers<a class="anchor" aria-label="anchor" href="#benefits-for-advanced-users-developers"></a>
</h3>
<ul>
<li><p><strong>Safer code:</strong> Bugs from invalid card or hand
objects are caught early</p></li>
<li><p><strong>Clearer APIs:</strong> Functions clearly expect and
return game objects</p></li>
<li><p><strong>Easy extension:</strong> Add new rules or card types with
minimal refactoring</p></li>
<li><p><strong>Better debugging:</strong> Informative errors when misuse
is detected</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="metaprogramming-generic-interfaces">üßµ Metaprogramming &amp; Generic Interfaces<a class="anchor" aria-label="anchor" href="#metaprogramming-generic-interfaces"></a>
</h2>
<p>While <strong><code>wombat21</code></strong> does not heavily rely on
<em>metaprogramming</em>, it demonstrates simple use of
<strong>expression evaluation</strong> and <strong>S3 generics</strong>
to enable flexible logic and modular game components.</p>
<div class="section level3">
<h3 id="metaprogramming-in-action">Metaprogramming in Action<a class="anchor" aria-label="anchor" href="#metaprogramming-in-action"></a>
</h3>
<p>A notable use of metaprogramming appears in our AI hit/stand decision
logic:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">while</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/eval_tidy.html" class="external-link">eval_tidy</a></span><span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html" class="external-link">expr</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">current_score</span> <span class="op">&lt;</span> <span class="fl">17</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This pattern lets us <strong>evaluate conditional logic
dynamically</strong>, which could be extended to support more advanced
decision trees or strategy DSLs.</p>
<p>Although simple here, this approach allows:</p>
<ul>
<li><p>Dynamic game strategies (e.g., thresholds that are
formula-based)</p></li>
<li><p>Pluggable control flows without hardcoding</p></li>
<li><p>Compatibility with user-defined logic in future
extensions</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="interface-design-via-s3">Interface Design via S3<a class="anchor" aria-label="anchor" href="#interface-design-via-s3"></a>
</h3>
<p>Beyond that, <strong>interface extensibility</strong> in
<code>wombat21</code> is achieved through clean <strong>S3
generics</strong>:</p>
<ul>
<li><p><code><a href="../reference/card_rank.html">card_rank()</a></code>, <code><a href="../reference/card_value.html">card_value()</a></code>, and
<code><a href="../reference/calculate_score.html">calculate_score()</a></code> all support <strong>class
dispatch</strong></p></li>
<li><p>Functions like <code><a href="../reference/card_rank.card.html">card_rank.card()</a></code> and
<code><a href="../reference/card_rank.character.html">card_rank.character()</a></code> make logic reusable across both S3
<code>card</code> objects and plain characters</p></li>
</ul>
<p>This gives:</p>
<ul>
<li><p><strong>Clear separation</strong> between internal logic and
user-visible objects</p></li>
<li><p><strong>Easy extension</strong> of new types (e.g.,
<code>joker_card</code>, <code>double_card</code>)</p></li>
<li><p>Consistent API behavior with helpful fallbacks and method
dispatch</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<div style="width:100%">
<table class="table">
<colgroup>
<col width="22%">
<col width="28%">
<col width="48%">
</colgroup>
<thead><tr class="header">
<th>Aspect</th>
<th>Technique Used</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Hit/stand condition</td>
<td><code><a href="https://rlang.r-lib.org/reference/eval_tidy.html" class="external-link">rlang::eval_tidy()</a></code></td>
<td>Dynamically evaluate game thresholds</td>
</tr>
<tr class="even">
<td>Rank/value logic</td>
<td>S3 generic dispatch</td>
<td>Allow multiple input types (<code>card</code>,
<code>char</code>)</td>
</tr>
<tr class="odd">
<td>Extendability</td>
<td>
<code><a href="https://vctrs.r-lib.org/reference/new_rcrd.html" class="external-link">vctrs::new_rcrd()</a></code> + S3</td>
<td>Build and validate extensible game types</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="want-to-do-more">Want to do more?<a class="anchor" aria-label="anchor" href="#want-to-do-more"></a>
</h3>
<ul>
<li><p>For more advanced <em>metaprogramming</em>, consider:</p></li>
<li><p>User-defined strategy expressions via quosures</p></li>
<li><p>Parameterized hit/stand rules embedded in <code><a href="../reference/play.html">play()</a></code>
flow</p></li>
<li><p>Callable logic passed in as closures (e.g.,
<code>split_func</code>, <code>insurance_func</code> ‚Äì which you already
support)</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="boosting-performance-with-rcpp">‚ö° Boosting Performance with Rcpp<a class="anchor" aria-label="anchor" href="#boosting-performance-with-rcpp"></a>
</h2>
<p>To speed up critical logic like <strong>score calculation</strong>,
<code>wombat21</code> uses a C++ backend via <code>Rcpp</code>. This
ensures fast, reliable, and vectorized performance even during
<strong>high-volume simulation</strong>.</p>
<div class="section level3">
<h3 id="whats-accelerated">What‚Äôs Accelerated<a class="anchor" aria-label="anchor" href="#whats-accelerated"></a>
</h3>
<p>The most computationally intense operation in Blackjack is score
calculation‚Äîespecially due to the <strong>variable value of
Aces</strong>. Instead of handling this in pure R every round, we
offload it to C++:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_score.html">calculate_score</a></span><span class="op">(</span><span class="va">hand</span><span class="op">)</span></span></code></pre></div>
<p>internally calls:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_score_cpp.html">calculate_score_cpp</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-it-works">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R wrapper (R/score_cal.R)</span></span>
<span><span class="va">calculate_score</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hand</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">ranks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/card_rank.html">card_rank</a></span><span class="op">(</span><span class="va">cards</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/calculate_score_cpp.html">calculate_score_cpp</a></span><span class="op">(</span><span class="va">ranks</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># C++: src/calculate_score.cpp</span></span>
<span><span class="co"># int calculate_score_cpp(std::vector&lt;std::string&gt; ranks);</span></span></code></pre></div>
<p>This ensures:</p>
<ul>
<li><p><strong>Low latency</strong> even with thousands of
hands</p></li>
<li><p><strong>Correct Ace handling</strong> (e.g., dual 1/11)</p></li>
<li><p><strong>Seamless integration</strong> with S3/vctrs
objects</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="when-to-use">When to Use<a class="anchor" aria-label="anchor" href="#when-to-use"></a>
</h3>
<p>You don‚Äôt need to call the C++ version
manually‚Äî<code><a href="../reference/calculate_score.html">calculate_score()</a></code> handles this for you. But
advanced users can test or use it directly:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_score_cpp.html">calculate_score_cpp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"9"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Returns 21</span></span></code></pre></div>
<p><strong>Speed Comparison (10,000 hands)</strong></p>
<div style="width:100%">
<table class="table">
<thead><tr class="header">
<th>Method</th>
<th>Elapsed Time (sec)</th>
<th>Relative Speed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Pure R (<code>calculate_score_r</code>)</td>
<td>0.28</td>
<td>1√ó (baseline)</td>
</tr>
<tr class="even">
<td>Rcpp C++ (<code>calculate_score</code>)</td>
<td>0.06</td>
<td>4.7√ó faster</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="testing-and-data-persistence">‚úÖ Testing and Data Persistence<a class="anchor" aria-label="anchor" href="#testing-and-data-persistence"></a>
</h2>
<p>The package uses unit tests (via testthat) and persistent storage
(e.g., <code><a href="../reference/save_players.html">save_players()</a></code>/<code><a href="../reference/load_players.html">load_players()</a></code>) to
ensure reliability and reproducibility for all features.</p>
</div>
<div class="section level2">
<h2 id="limitations">üöß Limitations<a class="anchor" aria-label="anchor" href="#limitations"></a>
</h2>
<ul>
<li><p><strong>wombat21</strong> is designed for flexibility and
extensibility, but there are still some current limitations:</p></li>
<li><p><strong>Single-deck only:</strong> Only single-deck Blackjack is
implemented; multi-deck or shoe games are not directly
supported.</p></li>
<li><p><strong>Standard rules only:</strong> Nonstandard Blackjack
variants (e.g., double exposure, Spanish 21) are not included but could
be added via user extensions.</p></li>
<li><p><strong>Strategy granularity:</strong> Simulation strategies are
customizable via function parameters, but built-in logic is
intentionally simple.</p></li>
<li><p><strong>No GUI:</strong> The package is console-based; no
graphical interface is provided (though plots are interactive).</p></li>
<li><p><strong>Persistence:</strong> Player data is saved locally, not
in a centralized/cloud-based system.</p></li>
<li><p><strong>Performance:</strong> Scoring uses C++ for speed, but
some highly complex batch simulations may be slower than pure
C++/Python.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="alternative-designs">üîÑ Alternative Designs<a class="anchor" aria-label="anchor" href="#alternative-designs"></a>
</h2>
<p>We considered several alternative approaches in developing
<strong>wombat21</strong>:</p>
<ul>
<li><p><strong>Pure S3 vs vctrs:</strong> Adopted vctrs for safer
extensible objects, could have used pure S3.</p></li>
<li><p><strong>R-only vs C++ backend:</strong> Chose C++ for batch
speed; R only is simpler but slower.</p></li>
<li><p><strong>Functional vs OOP:</strong> Prioritized functional
interfaces over OOP for composability.</p></li>
<li><p><strong>Integrated GUI:</strong> Focused on core logic, left out
Shiny/desktop GUI for clarity.</p></li>
<li><p><strong>Database/data.table support:</strong> Used R lists/local
files for simplicity; future work could add database
integration.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="ai-statement">ü§ñ AI Statement<a class="anchor" aria-label="anchor" href="#ai-statement"></a>
</h2>
<p>In compliance with University policy on responsible AI use, we openly
and clearly acknowledge <strong>extensive use of generative AI
tools‚Äîincluding OpenAI ChatGPT and GitHub Copilot‚Äîin the development of
this assignment.</strong></p>
<div class="section level3">
<h3 id="how-ai-was-used">How AI Was Used<a class="anchor" aria-label="anchor" href="#how-ai-was-used"></a>
</h3>
<ul>
<li><p><strong>Initial code generation and scaffolding:</strong><br>
Many basic functions, S3 class constructors, and control-flow templates
(such as for card creation, game setup, simulation loops, and some unit
tests) were generated with ChatGPT, then thoroughly reviewed, modified,
and integrated by the team.</p></li>
<li><p><strong>Language and documentation refinement:</strong><br>
AI was used to polish English language in the README, function
documentation, and code comments.</p></li>
<li><p><strong>Debugging and best practices:</strong><br>
We consulted ChatGPT for error explanations and debugging advice, always
reviewing and adapting outputs before inclusion.</p></li>
<li><p><strong>Design discussion and alternatives:</strong><br>
AI was used as a ‚Äúsecond opinion‚Äù in discussions about object systems,
file structure, and testing coverage, with all final design decisions
made by the team.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="how-ai-was-not-used">How AI Was <strong>Not</strong> Used<a class="anchor" aria-label="anchor" href="#how-ai-was-not-used"></a>
</h3>
<ul>
<li><p>AI was <strong>never</strong> used to submit unreviewed or
unedited answers.</p></li>
<li><p>No material was copied blindly from AI outputs‚Äîevery section was
checked, rewritten, and adapted.</p></li>
<li><p>All decisions and code integrations reflect our own understanding
and academic responsibility.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="accountability-and-academic-integrity">Accountability and Academic Integrity<a class="anchor" aria-label="anchor" href="#accountability-and-academic-integrity"></a>
</h3>
<ul>
<li><p>We accept full responsibility for all code, documentation, and
design decisions.</p></li>
<li><p>AI was used as an assistant for efficiency and idea generation,
not as a replacement for our learning.</p></li>
<li><p>All AI use is fully documented here, following University
transparency and integrity policies.</p></li>
<li><p>We are prepared to discuss or demonstrate any part of our work as
evidence of our engagement and understanding.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="limitations-and-reflection">Limitations and Reflection<a class="anchor" aria-label="anchor" href="#limitations-and-reflection"></a>
</h3>
<ul>
<li><p>AI-generated code often required significant rewriting or
adaptation to meet our standards.</p></li>
<li><p>Some AI suggestions were inefficient or incomplete; we improved
or replaced these sections as needed.</p></li>
<li><p>Test coverage currently emphasizes core logic; auxiliary features
may be less robust.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="example-prompts-used">Example Prompts Used<a class="anchor" aria-label="anchor" href="#example-prompts-used"></a>
</h3>
<ul>
<li><p>‚ÄúWrite an S3 constructor for a card object in R.‚Äù</p></li>
<li><p>‚ÄúHow to generate a unit test for splitting hands in Blackjack
using testthat?‚Äù</p></li>
<li><p>‚ÄúPolish the English in this README section.‚Äù</p></li>
<li><p>‚ÄúExplain how to fix this vctrs error in an R test.‚Äù</p></li>
<li><p>‚ÄúSuggest a yaml grouping for pkgdown user-facing and internal
functions.‚Äù</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="statement-of-responsibility">Statement of Responsibility<a class="anchor" aria-label="anchor" href="#statement-of-responsibility"></a>
</h3>
<p>We affirm that:</p>
<ul>
<li><p>All team members participated in using and reviewing AI-assisted
code and documentation, and all share responsibility for the submitted
work.</p></li>
<li><p>AI was used only as an aid; all logic, structure, and integration
reflect our own skills and decision-making.</p></li>
<li><p>Our use of AI aligns with University expectations for
responsible, transparent, and ethical assessment practice.</p></li>
</ul>
<div style="text-align: right;">
<p>Prepared by: Weizhu Chen, Sun Yan Joanna Ma, Aneesh Agarwal<br>
Date: 2025-06-06</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="team-contribution-summary">üßë‚Äçü§ù‚Äçüßë Team Contribution Summary<a class="anchor" aria-label="anchor" href="#team-contribution-summary"></a>
</h2>
<div style="width:100%">
<table class="table">
<colgroup>
<col width="15%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th>Name</th>
<th>Key Contributions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Weizhu Chen</td>
<td>- Designed and implemented main game loop and core mechanics<br>
- Developed S3 generics/methods (e.g., <code>card_rank</code>,
<code>vec_cast</code>)<br>
- Modularized and refactored codebase<br>
- Added simulation feature and usage examples<br>
- Improved documentation structure and naming consistency</td>
</tr>
<tr class="even">
<td>Joanna Ma</td>
<td>- Developed multi-player and computer player support<br>
- Implemented betting and coin management<br>
- Created visualization functions for player ranking and coin
history<br>
- Debugged and enhanced S3/vctrs compatibility<br>
- Helped with data storage and user interface troubleshooting</td>
</tr>
<tr class="odd">
<td>Aneesh Agarwal</td>
<td>- Developed and integrated C++ backend for fast hand scoring
(<code>calculate_score_cpp</code>)<br>
- Provided function examples and unit tests<br>
- Contributed to vignette and design documentation (including
metaprogramming choices)<br>
- Assisted in troubleshooting and code review</td>
</tr>
</tbody>
</table>
</div>
<div style="text-align: right;">
<p>For full details of team member roles, see the <a href="https://github.com/MonashARP/game-package-wombats" class="external-link">project
repository</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion-contribution">ü§ù Conclusion &amp; Contribution<a class="anchor" aria-label="anchor" href="#conclusion-contribution"></a>
</h2>
<p>We welcome feature requests, bug reports, and community
contributions. Feel free to open an issue or submit a pull request to
help make <code>wombat21</code> even better!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/joanna1016ma" class="external-link">Sun Yan Joanna Ma</a>, <a href="https://github.com/WZ-Ch01" class="external-link">Wei Zhu Chen</a>, <a href="https://github.com/AneeshAgarwala" class="external-link">Aneesh Agarwal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
